name: Bleeding Edge Dependencies Test
on:
  push:
  pull_request:
  schedule:
    - cron: '0 6 1 * *'   # First day of each month at 6:00 UTC
  workflow_dispatch: # Allow manual triggering for testing

jobs:
  test-bleeding-edge:
    name: "Bleeding Edge Dependencies: Python Latest"
    runs-on: ubuntu-latest
    continue-on-error: true
    steps:
      - uses: actions/checkout@v6
      - uses: snok/latest-python-versions@v1
        id: python-versions
        with:
          min-version: '3.14'
          include-prereleases: true
      - uses: actions/setup-python@v6
        with:
          python-version: ${{ fromJson(steps.python-versions.outputs.latest-python-versions)[0] }}
      - name: Download cleanvision test data
        run: |
          git clone https://github.com/cleanlab/assets.git
          mv assets/cleanlab_test_data ./tests/datalab/data
      - name: Install bleeding-edge dependencies
        run: |
          python -m pip install --upgrade pip
          pip install --pre --upgrade numpy scikit-learn pandas tqdm termcolor
          pip install --pre torch torchvision || pip install torch torchvision
          pip install -e ".[all]"
      - name: Install test dependencies
        run: pip install --no-cache-dir -r requirements-test-core.txt
      - name: Test with bleeding-edge deps
        run: pytest --verbose --maxfail=10 -m "not slow" --ignore=tests/test_frameworks.py --ignore=tests/test_model_pytorch_cnn.py